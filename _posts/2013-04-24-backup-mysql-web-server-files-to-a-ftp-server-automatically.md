---
id: 1542
title: Backup MySQL, Web server Files to a FTP Server Automatically
author: Stefano Marzorati
layout: post
guid: http://marzorati.co/?p=1542
permalink: /backup-mysql-web-server-files-to-a-ftp-server-automatically/
publicize_twitter_user:
  - marzorati_ste
  - marzorati_ste
authorsure_include_css:
  - 
dsq_thread_id:
  - 1905252270
categories:
  - Linux
---
`<br />
#!/bin/sh<br />
# System + MySQL backup script<br />
# Full backup day - Sun (rest of the day do incremental backup)<br />
# Copyright (c) 2005-2006 nixCraft<br />
# This script is licensed under GNU GPL version 2.0 or above<br />
# Automatically generated by http://bash.cyberciti.biz/backup/wizard-ftp-script.php<br />
# ---------------------------------------------------------------------</p>
<p>### System Setup ###<br />
DIRS="/etc /home"<br />
BACKUP=/tmp/backup.$$<br />
NOW=$(date +"%d-%m-%Y")<br />
INCFILE="/root/tar-inc-backup.dat"<br />
DAY=$(date +"%a")<br />
FULLBACKUP="Sun"</p>
<p>### MySQL Setup ###<br />
MUSER="root"<br />
MPASS="password"<br />
MHOST="localhost"<br />
MYSQL="$(which mysql)"<br />
MYSQLDUMP="$(which mysqldump)"<br />
GZIP="$(which gzip)"</p>
<p>### FTP server Setup ###<br />
FTPD="/test/incremental"<br />
FTPU="user"<br />
FTPP="password"<br />
FTPS="192.168.1.100"<br />
NCFTP="$(which ncftpput)"</p>
<p>### Other stuff ###<br />
EMAILID="name@acme.com"</p>
<p>### Start Backup for file system ###<br />
[ ! -d $BACKUP ] && mkdir -p $BACKUP || :</p>
<p>### See if we want to make a full backup ###<br />
if [ "$DAY" == "$FULLBACKUP" ]; then<br />
  FTPD="/test/full"<br />
  FILE="fs-full-$NOW.tar.gz"<br />
  tar -zcvf $BACKUP/$FILE $DIRS<br />
else<br />
  i=$(date +"%Hh%Mm%Ss")<br />
  FILE="fs-i-$NOW-$i.tar.gz"<br />
  tar -g $INCFILE -zcvf $BACKUP/$FILE $DIRS<br />
fi</p>
<p>### Start MySQL Backup ###<br />
# Get all databases name<br />
DBS="$($MYSQL -u $MUSER -h $MHOST -p$MPASS -Bse 'show databases')"<br />
for db in $DBS<br />
do<br />
 FILE=$BACKUP/mysql-$db.$NOW-$(date +"%T").gz<br />
 $MYSQLDUMP -u $MUSER -h $MHOST -p$MPASS $db | $GZIP -9 > $FILE<br />
done</p>
<p>### Dump backup using FTP ###<br />
#Start FTP backup using ncftp<br />
ncftp -u"$FTPU" -p"$FTPP" $FTPS<$T<br />
 echo "Hostname: $(hostname)" >>$T<br />
 echo "Backup failed" >>$T<br />
 mail  -s "BACKUP FAILED" "$EMAILID" <$T<br />
 rm -f $T<br />
fi<br />
`

Poi lo scheduli con il cron:  
`13 0 * * * /home/admin/bin/ftpbackup.sh >/dev/null 2>&1`

Backup script generator:

http://bash.cyberciti.biz/backup/wizard-ftp-script.php

via http://www.cyberciti.biz/tips/how-to-backup-mysql-databases-web-server-files-to-a-ftp-server-automatically.html